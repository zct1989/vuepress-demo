---
title: å‰ç«¯ä»£ç æäº¤ä¹‹è‡ªåŠ¨åŒ–å¥—è·¯ğŸ˜
tags:
  - javascript
categories:
  - å‰ç«¯
date: 2021-04-30 11:04:28
---

ä¹‹å‰çœ‹äº†[ä¼˜é›…çš„æäº¤ä½ çš„Git Commit Message](https://zhuanlan.zhihu.com/p/34223150)æ–‡ç« å,é¡¹ç›®ä¸­ä¸€ç›´ä¹ æƒ¯ä½¿ç”¨`husky`+`commitlint`+`lint-staged`ç»„åˆæ¥åœ¨æäº¤ä»£ç æ—¶æ£€æµ‹ä»£ç å’Œæäº¤é£æ ¼.

ä¸ç”¨è¯´ğŸ˜é‚£æ˜¯çœå¿ƒåˆçœåŠ›.ç»“æœæœ€è¿‘é‡æ–°æ­å»ºé¡¹ç›®æ—¶å‘ç°`husky`æ›´æ–°äº†,å¹¶ä¸”é…ç½®æœ‰äº†ä¸€äº›å˜åŒ–ğŸ˜‚,

é‚£ä¹ˆå°±æ¥æ•´ç†ä¸‹æ›´æ–°åhuskyçš„é…ç½®æ–¹æ³•.

---

### husky

åœ¨`husky`æ›´æ–°`6.0`çš„ç‰ˆæœ¬å,ç›¸å…³é…ç½®ä¹Ÿå‘ç”Ÿäº†å˜åŒ–,æ€»ä½“æ¥è¯´å˜å¾—æ›´åŠ ç®€æ´ä¸€äº›.


```shell
# npx husky-init
```

`husky-init`ä¼šè‡ªåŠ¨æ·»åŠ `husky`ä¾èµ–,å¹¶æ·»åŠ `prepare`çš„script.

ç„¶åä¼šå‘ç°å¤šå‡ºæ¥äº†ä¸€ä¸ª`.husky`ç›®å½•,ç„¶åå¯ä»¥é€šè¿‡`npx husky add`å‘½ä»¤æ·»åŠ å¯¹åº”çš„hook

```shell
# npx husky add .husky/commit-msg "npm test"
```

åœ¨`.husky`ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„`commit-msg`æ–‡ä»¶å°±æ˜¯ç›¸åº”çš„`husky`çš„`hook`æ–‡ä»¶

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm test
```

å½“æ‰§è¡Œå¯¹åº”çš„çš„`git hook`æ˜¯å°±ä¼šæ‰§è¡Œå¯¹åº”çš„`husky hook`æ–‡ä»¶äº†


### commitlint
---

é€šè¿‡`commitlint`å¯ä»¥å®Œæˆå¯¹æäº¤æ—¶çš„`commit message`æ£€æµ‹.


å®‰è£…`commitlint`

```shell
# yarn add @commitlint/config-conventional @commitlint/cli -D
```

å¯ä»¥åœ¨`package.json`é…ç½®ç›¸å…³æ£€æµ‹è§„åˆ™

```json
// package.json
...
"commitlint": {
    "extends": [
        "@commitlint/config-conventional"
    ]
}
```

ä¹Ÿå¯ä»¥å°†é…ç½®æå–åˆ°`commitlint.config.js`æ–‡ä»¶ä¸­å•ç‹¬é…ç½®


åœ¨`extends`ä¸­æŒ‡å®šé…ç½®æ–‡ä»¶å¯ä»¥æ¥å®ç°è‡ªå®šä¹‰é…ç½®


```javascript
// commitlint.config.js
module.exports = {
  extends: ['./commitlint.base.js', './commitlint.types.js'],
};
```

å…·ä½“é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹çš„[é…ç½®æ–‡æ¡£](https://commitlint.js.org/#/reference-configuration) 

ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ·»åŠ `hook`æ¥åœ¨`commit`æ—¶è°ƒç”¨`commitlint`äº†

```shell
# npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```

### lint-staged

é€šè¿‡`lint-staged`å¯ä»¥åœ¨ä»£ç `commit`å‰æ¥æ‰§è¡Œä»£ç è´¨é‡æ£€æµ‹,æ¥ä¿è¯ä»£ç é€šè¿‡æ£€æµ‹åæ‰å¯æäº¤.

å®‰è£…`list-staged`

``` shell
# yarn add lint-staged -D
```

ç„¶åæ·»åŠ `lint-staged`çš„ç›¸å…³é…ç½®,å¯ä»¥åœ¨`package.json`ä¸­,ä¹Ÿå¯ä»¥åˆ›å»ºå•ç‹¬çš„é…ç½®æ–‡ä»¶


* lint-staged.config.js
* .lintstagedrc.json
* .lintstagedrc.yaml
* .lintstagedrc.yml
* .lintstagedrc.js
* .lintstagedrc.cjs


```json
 {
        "*.ts!*.d.ts": [
            "eslint  --fix",
            "prettier --write",
            "git add ."
        ],
        "*.vue": [
            "eslint  --fix",
            "prettier --write",
            "git add ."
        ],
        "*.js": "eslint --cache --fix",
        "*.css": "stylelint --fix"
}
```

æŒ‰å¯¹åº”çš„æ–‡ä»¶åç¼€é…ç½®å¯¹åº”çš„ç›¸å…³ä»£ç æ£€æµ‹å°±å¥½.


æœ€åè®°å¾—æ¥æ·»åŠ å¯¹åº”çš„`hook`æ¥

```shell
# npx husky add .husky/pre-commit 'npx --no-install lint-staged'
```

æ³¨æ„çš„æ˜¯`lint-staged`æ£€æµ‹çš„æ˜¯æœ¬åœ°ä»£ç æäº¤çš„å†…å®¹,è®°å¾—åœ¨ä»£ç ä¿®æ”¹åæ‰§è¡Œ`git add`æ¥å°†ä¿®æ”¹æ·»åŠ åˆ°æäº¤åˆ—è¡¨é‡Œ.


### commitizen

è¿˜æœ‰å°±æ˜¯é€šè¿‡`commitizen`æ¥ä»£æ›¿ä½ çš„`git commit`æ¥ç”Ÿæˆæ ¼å¼åŒ–çš„æäº¤æ¶ˆæ¯

```shell
# yarn add commitizen cz-conventional-changelog -D
```

ä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦è¡¨æƒ…çš„`cz-conventional-changelog-emoji`

åœ¨package.jsonæ·»åŠ ç›¸åº”é…ç½®å³å¯
```json
"script": {
    "commit": "git-cz",
},
"config": {
        "commitizen": {
            "path": "cz-conventional-changelog-emoji"
        }
}
```

å¦‚æœéœ€è¦æ·»åŠ è‡ªå®šä¹‰çš„æäº¤é€‰é¡¹å¯ä»¥å®‰è£…`cz-customizable`æ¥å®ç°.

```json
"config": {
  "commitizen": { // not needed for standlone usage
    "path": "node_modules/cz-customizable"
  },
  "cz-customizable": {
    "config": "config/path/to/my/.cz-config.js"
  }
}
```

ç„¶åæŒ‰ç…§è‡ªå·±çš„éœ€è¦è¿›è¡Œé…ç½®å³å¯

```javascript
// .cz-config.js
module.exports = {
  types: [
    {
      value: 'feat',
      name : 'feat:     A new feature'
    },
    {
      value: 'fix',
      name : 'fix:      A bug fix'
    },
    {
      value: 'docs',
      name : 'docs:     Documentation only changes'
    },
    {
      value: 'refactor',
      name : 'refactor: A code change that neither fixes a bug nor adds a feature'
    },
    {
      value: 'perf',
      name : 'perf:     A code change that improves performance'
    },
    {
      value: 'test',
      name : 'test:     Add missing tests or correcting existing tests'
    },
    {
      value: 'build',
      name : 'build:    Add missing tests or correcting existing tests'
    },
    {
      value: 'revert',
      name : 'revert:   Revert to a commit'
    }
  ],
  allowBreakingChanges: ['feat', 'fix', 'refactor', 'perf', 'build', 'revert']
};
```

